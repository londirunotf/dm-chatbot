{% extends "admin/base.html" %}

{% block content %}
<div class="simple-import-container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="page-header">
        <h1>ğŸ“¥ FAQã‚’ã¾ã¨ã‚ã¦è¿½åŠ </h1>
        <a href="{{ url_for('admin.faq_list') }}" class="btn-back">â† æˆ»ã‚‹</a>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³æ“ä½œã‚¨ãƒªã‚¢ -->
    <div class="main-content">
        <!-- å·¦å´: ç°¡å˜èª¬æ˜ -->
        <div class="explain-section">
            <h2>ğŸ“ ä½¿ã„æ–¹</h2>
            <div class="simple-steps">
                <div class="step">1. Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’æº–å‚™</div>
                <div class="step">2. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</div>
                <div class="step">3. ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
            </div>
            <div class="format-note">
                <strong>å¯¾å¿œå½¢å¼:</strong> Excel (.xlsx) ã¾ãŸã¯ CSV (.csv)
            </div>
        </div>

        <!-- å³å´: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ -->
        <div class="upload-section">
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="file-drop-zone" id="dropZone">
                    <div class="drop-content">
                        <div class="upload-icon">ğŸ“</div>
                        <h3>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
                        <button type="button" class="btn-choose-file" onclick="document.getElementById('fileInput').click()">
                            ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶
                        </button>
                        <input type="file" id="fileInput" name="file" accept=".xlsx,.xls,.csv" style="display: none;">
                        <p class="drop-hint">ã¾ãŸã¯ã€ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
                    </div>
                    
                    <div class="selected-file" id="selectedFile" style="display: none;">
                        <div class="file-info">
                            <span class="file-icon">ğŸ“„</span>
                            <span class="file-name" id="fileName"></span>
                            <button type="button" class="btn-remove" onclick="removeFile()">âœ•</button>
                        </div>
                    </div>
                </div>
                
                <button type="submit" class="btn-upload" id="uploadBtn" disabled>
                    â¬†ï¸ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                </button>
            </form>
        </div>
    </div>

    <!-- ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã‚¬ã‚¤ãƒ‰ -->
    <div class="guide-section">
        <h2>ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ–¹æ³•</h2>
        
        <div class="guide-tabs">
            <button class="guide-tab active" data-guide="excel">Excel</button>
            <button class="guide-tab" data-guide="csv">CSV</button>
        </div>
        
        <!-- Excelä½œæˆã‚¬ã‚¤ãƒ‰ -->
        <div id="excel-guide" class="guide-content active">
            <div class="quick-guide">
                <h3>1. Excelã§ä»¥ä¸‹ã®é …ç›®ã‚’å…¥åŠ›</h3>
                <div class="column-guide">
                    <table class="simple-table">
                        <thead>
                            <tr>
                                <th class="required">title<br><small>ã‚¿ã‚¤ãƒˆãƒ«</small></th>
                                <th class="required">question<br><small>è³ªå•</small></th>
                                <th class="required">answer<br><small>å›ç­”</small></th>
                                <th class="optional">category<br><small>ã‚«ãƒ†ã‚´ãƒª</small></th>
                                <th class="optional">keywords<br><small>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</small></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œ</td>
                                <td>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚Œã¾ã—ãŸ</td>
                                <td>ç®¡ç†è€…ã«ã”é€£çµ¡ãã ã•ã„</td>
                                <td>åŸºæœ¬æ“ä½œ</td>
                                <td>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰,å¿˜ã‚ŒãŸ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="field-note">
                    <span class="required-note">èµ¤è‰²ã¯å¿…é ˆ</span>
                    <span class="optional-note">é’è‰²ã¯ä»»æ„</span>
                </div>
                
                <h3>2. .xlsxå½¢å¼ã§ä¿å­˜</h3>
                <p>ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€â†’ã€Œåå‰ã‚’ä»˜ã‘ã¦ä¿å­˜ã€â†’ã€ŒExcel (.xlsx)ã€</p>
            </div>
        </div>
        
        <!-- CSVä½œæˆã‚¬ã‚¤ãƒ‰ -->
        <div id="csv-guide" class="guide-content">
            <div class="quick-guide">
                <h3>1. ä»¥ä¸‹ã®å½¢å¼ã§å…¥åŠ›</h3>
                <div class="csv-example">
                    <code>title,question,answer,category,keywords<br>
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¿˜ã‚Œ,ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚Œã¾ã—ãŸ,ç®¡ç†è€…ã«ã”é€£çµ¡ãã ã•ã„,åŸºæœ¬æ“ä½œ,ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»å¿˜ã‚ŒãŸ</code>
                </div>
                
                <h3>2. .csvå½¢å¼ã§ä¿å­˜</h3>
                <p>ãƒ¡ãƒ¢å¸³ã‚„Excelã§ã€ŒCSVå½¢å¼ã€ã‚’é¸æŠã—ã¦ä¿å­˜</p>
            </div>
        </div>
    </div>

    <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ -->
    <div class="sample-section">
        <h2>ğŸ“¥ ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«</h2>
        <p>å‚è€ƒã«ã—ã¦ãã ã•ã„</p>
        <div class="sample-buttons">
            <button class="btn-sample" onclick="downloadExcelSample()">ğŸ“Š Excelã‚µãƒ³ãƒ—ãƒ«</button>
            <button class="btn-sample" onclick="downloadCSVSample()">ğŸ“‹ CSVã‚µãƒ³ãƒ—ãƒ«</button>
        </div>
    </div>

    <!-- å‡¦ç†çŠ¶æ³ -->
    <div id="uploadStatus" class="status-section" style="display: none;">
        <div class="status-content" id="statusContent">
            <!-- å‹•çš„ã«æ›´æ–° -->
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
/* ã‚·ãƒ³ãƒ—ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ */
.simple-import-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 20px;
    font-family: "Hiragino Kaku Gothic Pro", sans-serif;
    font-size: 16px;
    line-height: 1.6;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 10px;
}

.page-header h1 {
    color: #2c3e50;
    margin: 0;
    font-size: 24px;
    font-weight: bold;
}

.btn-back {
    background: #6c757d;
    color: white;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 5px;
    font-size: 14px;
}

.btn-back:hover {
    background: #5a6268;
    text-decoration: none;
    color: white;
}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.main-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 40px;
    margin-bottom: 40px;
}

/* å·¦å´: èª¬æ˜ã‚¨ãƒªã‚¢ */
.explain-section {
    background: #e8f4fd;
    padding: 30px;
    border-radius: 10px;
    border-left: 5px solid #007bff;
}

.explain-section h2 {
    color: #004085;
    margin: 0 0 20px 0;
    font-size: 20px;
}

.simple-steps {
    margin-bottom: 20px;
}

.step {
    background: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    font-weight: bold;
    color: #495057;
    border-left: 4px solid #28a745;
}

.format-note {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    font-size: 14px;
    color: #6c757d;
}

/* å³å´: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒªã‚¢ */
.upload-section {
    background: #f8f9fa;
    padding: 30px;
    border-radius: 10px;
    border: 2px dashed #dee2e6;
}

.file-drop-zone {
    text-align: center;
    padding: 40px 20px;
    background: white;
    border-radius: 10px;
    margin-bottom: 20px;
}

.file-drop-zone.drag-over {
    background: #e3f2fd;
    border-color: #007bff;
}

.upload-icon {
    font-size: 60px;
    color: #6c757d;
    margin-bottom: 15px;
}

.drop-content h3 {
    color: #495057;
    margin: 0 0 20px 0;
    font-size: 18px;
}

.btn-choose-file {
    background: #007bff;
    color: white;
    border: none;
    padding: 15px 30px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin-bottom: 15px;
    font-weight: bold;
}

.btn-choose-file:hover {
    background: #0056b3;
}

.drop-hint {
    color: #6c757d;
    font-size: 14px;
    margin: 0;
}

.selected-file {
    background: #d4edda;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #28a745;
}

.file-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.file-icon {
    font-size: 20px;
}

.file-name {
    flex: 1;
    color: #155724;
    font-weight: bold;
}

.btn-remove {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    color: #dc3545;
}

.btn-upload {
    width: 100%;
    background: #28a745;
    color: white;
    border: none;
    padding: 15px;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
}

.btn-upload:hover:not(:disabled) {
    background: #218838;
}

.btn-upload:disabled {
    background: #6c757d;
    cursor: not-allowed;
}

/* ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.guide-section {
    background: #f1f3f4;
    padding: 30px;
    border-radius: 10px;
    margin-bottom: 30px;
}

.guide-section h2 {
    color: #2c3e50;
    margin: 0 0 20px 0;
    font-size: 20px;
    text-align: center;
}

/* ã‚·ãƒ³ãƒ—ãƒ«ã‚¿ãƒ– */
.guide-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    justify-content: center;
}

.guide-tab {
    background: #6c757d;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
}

.guide-tab:hover {
    background: #5a6268;
}

.guide-tab.active {
    background: #007bff;
}

/* ã‚¬ã‚¤ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.guide-content {
    display: none;
    background: white;
    padding: 20px;
    border-radius: 8px;
}

.guide-content.active {
    display: block;
}

.quick-guide h3 {
    color: #495057;
    margin: 0 0 15px 0;
    font-size: 16px;
    font-weight: bold;
}

.quick-guide p {
    margin: 10px 0;
    color: #6c757d;
    font-size: 14px;
}

/* ã‚·ãƒ³ãƒ—ãƒ«ãƒ†ãƒ¼ãƒ–ãƒ« */
.column-guide {
    margin-bottom: 20px;
}

.simple-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
}

.simple-table th,
.simple-table td {
    padding: 10px;
    border: 1px solid #dee2e6;
    text-align: left;
}

.simple-table th {
    background: #f8f9fa;
    font-weight: bold;
}

.simple-table th.required {
    background: #f8d7da;
    color: #721c24;
}

.simple-table th.optional {
    background: #cce5ff;
    color: #004085;
}

.simple-table small {
    display: block;
    font-size: 12px;
    color: #6c757d;
}

.field-note {
    display: flex;
    gap: 20px;
    justify-content: center;
    margin: 15px 0;
    font-size: 14px;
}

.required-note {
    color: #dc3545;
    font-weight: bold;
}

.optional-note {
    color: #007bff;
    font-weight: bold;
}

/* CSVä¾‹ */
.csv-example {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin: 15px 0;
    border: 1px solid #dee2e6;
}

.csv-example code {
    font-family: monospace;
    font-size: 13px;
    line-height: 1.4;
    color: #495057;
}

/* ã‚µãƒ³ãƒ—ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.sample-section {
    background: #fff3cd;
    padding: 20px;
    border-radius: 8px;
    border-left: 4px solid #ffc107;
    margin-bottom: 30px;
    text-align: center;
}

.sample-section h2 {
    color: #856404;
    margin: 0 0 10px 0;
    font-size: 18px;
}

.sample-section p {
    color: #856404;
    margin: 0 0 15px 0;
    font-size: 14px;
}

.sample-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

.btn-sample {
    background: #ffc107;
    color: #212529;
    border: none;
    padding: 10px 20px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
}

.btn-sample:hover {
    background: #e0a800;
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
.status-section {
    background: #f5f5f5;
    padding: 20px;
    border-radius: 10px;
    margin-top: 20px;
    border-left: 4px solid #007bff;
}

.status-content {
    font-size: 16px;
}

.loading {
    text-align: center;
    color: #007bff;
    font-size: 18px;
}

.success {
    background: #d4edda;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #28a745;
}

.success h4 {
    color: #155724;
    margin: 0 0 10px 0;
}

.error {
    background: #f8d7da;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #dc3545;
}

.error h4 {
    color: #721c24;
    margin: 0 0 10px 0;
}

.warning {
    background: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #ffc107;
    margin-top: 15px;
}

.warning h4 {
    color: #856404;
    margin: 0 0 10px 0;
}

.actions {
    text-align: center;
    margin-top: 20px;
}

.actions .btn {
    background: #28a745;
    color: white;
    padding: 12px 30px;
    text-decoration: none;
    border-radius: 8px;
    display: inline-block;
}

.actions .btn:hover {
    background: #218838;
    text-decoration: none;
    color: white;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
@media (max-width: 768px) {
    .main-content {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .sample-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .field-note {
        flex-direction: column;
        text-align: center;
        gap: 10px;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('fileInput');
    const dropZone = document.getElementById('dropZone');
    const selectedFileDiv = document.getElementById('selectedFile');
    const fileNameSpan = document.getElementById('fileName');
    const uploadBtn = document.getElementById('uploadBtn');
    const uploadForm = document.getElementById('uploadForm');
    
    // ã‚¬ã‚¤ãƒ‰ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    const guideTabs = document.querySelectorAll('.guide-tab');
    const guideContents = document.querySelectorAll('.guide-content');
    
    guideTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            guideTabs.forEach(t => t.classList.remove('active'));
            guideContents.forEach(c => c.classList.remove('active'));
            
            this.classList.add('active');
            const targetContent = document.getElementById(this.dataset.guide + '-guide');
            if (targetContent) {
                targetContent.classList.add('active');
            }
        });
    });
    
    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†
    fileInput.addEventListener('change', function() {
        handleFileSelect(this.files[0]);
    });
    
    // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å‡¦ç†
    dropZone.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('drag-over');
    });
    
    dropZone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
    });
    
    dropZone.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
        
        const file = e.dataTransfer.files[0];
        if (file) {
            handleFileSelect(file);
        }
    });
    
    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠå‡¦ç†
    function handleFileSelect(file) {
        if (!file) return;
        
        const fileName = file.name.toLowerCase();
        const validFormats = ['.xlsx', '.xls', '.csv'];
        const isValid = validFormats.some(format => fileName.endsWith(format));
        
        if (!isValid) {
            alert('Excel (.xlsx, .xls) ã¾ãŸã¯ CSV (.csv) ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º
        fileNameSpan.textContent = file.name;
        dropZone.querySelector('.drop-content').style.display = 'none';
        selectedFileDiv.style.display = 'block';
        uploadBtn.disabled = false;
        
        // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã«è¨­å®š
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        fileInput.files = dataTransfer.files;
    }
    
    // ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
    window.removeFile = function() {
        fileInput.value = '';
        selectedFileDiv.style.display = 'none';
        dropZone.querySelector('.drop-content').style.display = 'block';
        uploadBtn.disabled = true;
    };
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    uploadForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (!fileInput.files.length) {
            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        handleUpload();
    });
    
    function handleUpload() {
        const formData = new FormData(uploadForm);
        const statusSection = document.getElementById('uploadStatus');
        const statusContent = document.getElementById('statusContent');
        
        // å‡¦ç†çŠ¶æ³è¡¨ç¤º
        statusSection.style.display = 'block';
        statusContent.innerHTML = '<div class="loading">ğŸ“¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...<br>ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„</div>';
        
        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
        uploadBtn.disabled = true;
        uploadBtn.textContent = 'å‡¦ç†ä¸­...';
        
        // AJAXé€ä¿¡
        fetch('{{ url_for("admin.bulk_import_faq") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                statusContent.innerHTML = `
                    <div class="error">
                        <h4>âŒ å–ã‚Šè¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</h4>
                        <p>${data.error}</p>
                        <p><strong>è§£æ±ºæ–¹æ³•ï¼š</strong></p>
                        <ul>
                            <li>ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
                            <li>å¿…é ˆé …ç›®ï¼ˆtitleã€questionã€answerï¼‰ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„</li>
                            <li>ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚è€ƒã«ä¿®æ­£ã—ã¦ãã ã•ã„</li>
                        </ul>
                    </div>
                `;
            } else {
                let resultHtml = `
                    <div class="success">
                        <h4>âœ… å–ã‚Šè¾¼ã¿å®Œäº†ã—ã¾ã—ãŸï¼</h4>
                        <p><strong>${data.imported_count}ä»¶</strong>ã®FAQãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚</p>
                    </div>
                `;
                
                if (data.errors && data.errors.length > 0) {
                    resultHtml += `
                        <div class="warning">
                            <h4>âš ï¸ ä¸€éƒ¨ã®ãƒ‡ãƒ¼ã‚¿ã§ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã—ãŸ</h4>
                            <p>ä»¥ä¸‹ã®è¡Œã¯å–ã‚Šè¾¼ã¾ã‚Œã¾ã›ã‚“ã§ã—ãŸï¼š</p>
                            <ul>
                                ${data.errors.slice(0, 5).map(error => `<li>${error}</li>`).join('')}
                            </ul>
                            ${data.errors.length > 5 ? `<p>ä»– ${data.errors.length - 5} ä»¶ã®ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã—ãŸã€‚</p>` : ''}
                        </div>
                    `;
                }
                
                resultHtml += `
                    <div class="actions">
                        <a href="{{ url_for('admin.faq_list') }}" class="btn">
                            ğŸ“‹ FAQä¸€è¦§ã‚’ç¢ºèªã™ã‚‹
                        </a>
                    </div>
                `;
                
                statusContent.innerHTML = resultHtml;
            }
        })
        .catch(error => {
            statusContent.innerHTML = `
                <div class="error">
                    <h4>âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h4>
                    <p>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ã€ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                    <p><strong>ã‚¨ãƒ©ãƒ¼è©³ç´°:</strong> ${error.message}</p>
                </div>
            `;
        })
        .finally(() => {
            // ãƒœã‚¿ãƒ³ã‚’å…ƒã«æˆ»ã™
            uploadBtn.disabled = false;
            uploadBtn.textContent = 'â¬†ï¸ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰';
        });
    }
    
    // ã‚µãƒ³ãƒ—ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    window.downloadExcelSample = function() {
        const csvContent = `title,question,answer,category,keywords
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸ,ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸ,ç®¡ç†è€…ã«ãŠç”³ã—å‡ºãã ã•ã„ã€‚æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã„ãŸã—ã¾ã™ã€‚,åŸºæœ¬æ“ä½œ,ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»å¿˜ã‚ŒãŸãƒ»å†ç™ºè¡Œ
ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„,ãƒ­ã‚°ã‚¤ãƒ³ãŒã§ãã¾ã›ã‚“,ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯ç®¡ç†è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚,åŸºæœ¬æ“ä½œ,ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ»IDãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
ã‚·ã‚¹ãƒ†ãƒ ãŒé‡ã„,ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œãŒé‡ã„ã§ã™,ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èµ·å‹•ã—ã¦ãŠè©¦ã—ãã ã•ã„ã€‚æ”¹å–„ã—ãªã„å ´åˆã¯ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚,ãƒˆãƒ©ãƒ–ãƒ«,é‡ã„ãƒ»é…ã„ãƒ»å‹•ä½œãƒ»ãƒ–ãƒ©ã‚¦ã‚¶`;
        
        downloadFile(csvContent, 'FAQã‚µãƒ³ãƒ—ãƒ«.csv', 'text/csv;charset=utf-8');
    };
    
    window.downloadCSVSample = function() {
        const csvContent = `title,question,answer,category,keywords
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸ,ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸ,ç®¡ç†è€…ã«ãŠç”³ã—å‡ºãã ã•ã„ã€‚æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç™ºè¡Œã„ãŸã—ã¾ã™ã€‚,åŸºæœ¬æ“ä½œ,ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ»å¿˜ã‚ŒãŸãƒ»å†ç™ºè¡Œ
ãƒ­ã‚°ã‚¤ãƒ³ã§ããªã„,ãƒ­ã‚°ã‚¤ãƒ³ãŒã§ãã¾ã›ã‚“,ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆã¯ç®¡ç†è€…ã¾ã§ã”é€£çµ¡ãã ã•ã„ã€‚,åŸºæœ¬æ“ä½œ,ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚¨ãƒ©ãƒ¼ãƒ»IDãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
ã‚·ã‚¹ãƒ†ãƒ ãŒé‡ã„,ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œãŒé‡ã„ã§ã™,ãƒ–ãƒ©ã‚¦ã‚¶ã‚’å†èµ·å‹•ã—ã¦ãŠè©¦ã—ãã ã•ã„ã€‚æ”¹å–„ã—ãªã„å ´åˆã¯ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚,ãƒˆãƒ©ãƒ–ãƒ«,é‡ã„ãƒ»é…ã„ãƒ»å‹•ä½œãƒ»ãƒ–ãƒ©ã‚¦ã‚¶`;
        
        downloadFile(csvContent, 'FAQã‚µãƒ³ãƒ—ãƒ«.csv', 'text/csv;charset=utf-8');
    };
    
    function downloadFile(content, filename, contentType) {
        const blob = new Blob(['\ufeff' + content], { type: contentType }); // BOMä»˜ãUTF-8
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
});
</script>
{% endblock %}